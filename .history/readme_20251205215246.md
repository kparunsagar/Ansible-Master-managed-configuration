ansible-demo/
├── inventory.ini
├── site.yml             # Main playbook (calls roles)
├── roles/
│   ├── git/
│   │   ├── tasks/
│   │   │   └── main.yml
│   │   └── vars/
│   │       └── main.yml
│   └── docker/
│       ├── tasks/
│       │   └── main.yml
│       └── vars/
│           └── main.yml
├── group_vars/
│   └── slaves.yml       # Variables for all slave hosts

# Login
az login

# Create a resource group
az group create --name ansible-demo-rg --location centralindia

# Create the master VM
az vm create \
  --resource-group ansible-demo-rg \
  --name ansible-master \
  --image Ubuntu2204 \
  --size Standard_B1s \
  --admin-username azureuser \
  --generate-ssh-keys

# Create slave VMs (repeat or loop for more)
az vm create \
  --resource-group ansible-demo-rg \
  --name ansible-slave-1 \
  --image Ubuntu2204 \
  --size Standard_B1s \
  --admin-username azureuser \
  --generate-ssh-keys

az vm create \
  --resource-group ansible-demo-rg \
  --name ansible-slave-2 \
  --image Ubuntu2204 \
  --size Standard_B1s \
  --admin-username azureuser \
  --generate-ssh-keys

az vm create \
  --resource-group ansible-demo-rg \
  --name ansible-slave-3 \
  --image Ubuntu2204 \
  --size Standard_B1s \
  --admin-username azureuser \
  --generate-ssh-keys

# Grab the public IPs to use later
az vm list-ip-addresses -g ansible-demo-rg -o table

# From your local machine, SSH into master
ssh azureuser@<master-public-ip>

# Ensure you have a keypair (created by Azure); if not, create one
ls ~/.ssh/id_rsa || ssh-keygen -t rsa -b 4096

# master

ls -l ~/.ssh/id_rsa.pub  (copy key)

# slave
mkdir -p ~/.ssh
nano ~/.ssh/authorized_keys  (paste)
chmod 700 ~/.ssh
chmod 600 ~/.ssh/authorized_keys

# Test from Master

ssh -i ~/.ssh/id_rsa azureuser@slave

# On the Master
sudo apt update
sudo apt install -y ansible python3-pip
ansible --version
mkdir -p ~/ansible-demo && cd ~/ansible-demo

# create inventory
# ~/ansible-demo/inventory.ini
[Worker machine]
slave1 ansible_host=<slave1-public-ip> ansible_user=azureuser
slave2 ansible_host=<slave2-public-ip> ansible_user=azureuser
slave3 ansible_host=<slave3-public-ip> ansible_user=azureuser

# Test ansible connectivity
ansible -i inventory.ini all -m ping

----------------------------

inventory.ini

[slaves]
slave1 ansible_host=135.13.23.149 ansible_user=azureuser
slave2 ansible_host=<IP2> ansible_user=azureuser
slave3 ansible_host=<IP3> ansible_user=azureuser
-------------------------------

site.yml

---
- hosts: slaves
  become: yes
  roles:
    - git
    - docker

--------------------------

roles/git/tasks/main.yml

- name: Install Git
  apt:
    name: git
    state: present
    update_cache: yes

- name: Configure Git username
  git_config:
    name: user.name
    scope: global
    value: "{{ git_username }}"

- name: Configure Git email
  git_config:
    name: user.email
    scope: global
    value: "{{ git_email }}"
-----------------
group_vars/slaves.yml

git_username: "Arun Demo"
git_email: "arun@example.com"
git_default_branch: "main"

